# Social Network System Design

## Требования от бизнеса

- Публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия.
- Оценка и комментарии постов других путешественников.
- Подписка на других путешественников, чтобы следить за их активностью.
- Поиск популярных мест для путешествий и просмотр постов с этих мест.
- Просмотр ленты других путешественников и ленты пользователя, основанной на подписках в обратном хронологическом порядке.

### Будущая аудитория

- Предполагается, что через год система достигнет **10,000,000 уникальных пользователей в день** и будет продолжать расти.
- Ориентируемся на аудиторию **стран СНГ**.

## Домашняя работа. Урок 1

### Формализация функциональных требований

- **Пользователь** имеет аккаунт с личной информацией (фотографии + текстовые данные).
- Пользователь может публиковать **посты** (фотография + небольшое описание).
- **Места путешествий** подготовлены заранее.
- Пользователь может **подписываться** на других участников.
- Пользователь видит **список подписок**.
- Пользователь может **просматривать посты** других участников (ленту).
- Пользователь может **оценивать** и **комментировать** посты других пользователей.
- Система должна предоставлять **поиск по местам** и просмотр постов.
- Система должна поддерживать **хронологический порядок** постов.

#### можно реализовать не в первой итерации.
- Система должна **уведомлять пользователя** о новых комментариях и постах.

### Нефункциональные требования

- **DAU (ежедневно активных пользователей)** — 10,000,000, с линейным ростом.
- Ориентируемся на **аудиторию СНГ**.
- Данные должны **храниться вечно**.
- **Мониторинг с системой оповещений** и система логирования.
- **Надежность** необходима горизонтальная масштабируемость, так же система должна переживать отказы узлов.
                 система дожна уметь восстанавливаться после сбоев за **5 - 10m**.
                 система должна делать бэкапы раз в **12h**.
                 система должна уметь переживать пиковые нагрузки(обычная нагрузка * множитель сезона * 1.5)
- **Latency:** чтение ленты(общей и конкретного пользователя) **1 - 3s**.
               публикация поста **1 - 2s**.
               публикация реакции **< 1s**.
               публикация комментария **1 - 2s**.
- **Availability: 99.9%**.
- **Безопасность** многофакторная аутентификация  **MFA**.
                   обязательные сложные пароли.
                   вся чувствительная информация, такая как пароли и личные данные, хранится в зашифрованном виде с использованием алгоритма **AES**.
                   **CAPTCHA** для защиты от брутфорс-атак.
                   шифрование данных - **SSL**.
                   защита от  **DDoS-атак** - **Cloudflare**.
                   защита от  **XSS** - фильтрация ввода пользователя.
                   **GDPR**.

### Активности пользователей

- **Write operations**:
  - Реакция на пост: **5 в день**.
  - Комментарий на пост: **3 в день**.
  - Публикация постов: **1/3 в день**.

- **Read operations**:
  - Просмотр ленты: **100 раз в день** (по 10 объектов за раз).
  - Просмотр комментариев: **50 в день**

### Лимиты

- **Сообщение к посту**: длина до **1000 символов**.
- **Комментарий к посту**: длина до **280 символов**.
- **Фото в ленте**: вес **150 KB**.

### Сезонность

- Летом нагрузка может возрасти в **2 - 3 раза**.

### Транзакции

#### Транзакция — пост
- `id`: 16 байт
- `created_at`: 4 байта
- `photos`: 153.000 байт (для одного фото, в среднем 3 фото на пост)
- `text`: 1000 байт
- `user_id`: 8 байта
- `place_id`: 4 байта

#### Транзакция — комментарий
- `id`: 16 байт
- `created_at`: 4 байта
- `text`: 1000 байт
- `post_id`: 8 байт

#### Транзакция — реакция
- `id`: 16 байт
- `created_at`: 4 байта
- `user_id` 8 байта
- `post_id`: 8 байт
- `reaction_id`: 4 байта

---

## Нагрузка

### Пост

- **RPS (write)** — `DAU * 0.33 / 86400 = 38`
- **RPS (read)** — `DAU * 100 / 86400 = 11574`

---

#### Пост - медиа(текст и фото)

- **Traffic (write)** — `38 * 460 KB = 17.5 MB`
- **Traffic (read)** — `11574 * 460 KB = 5,200.38 MB`

---

#### Пост - метаинформация(все кроме текста и фото)

- **Traffic (write)** — `38 * 32 B = 1 KB`
- **Traffic (read)** — `11574 * 32 B = 361 KB`

---

### Комментарий

- **RPS (write)** — `DAU * 3 / 86400 = 345`
- **RPS (read)** — `DAU * 50 / 86400 = 5,778`

---

### Комментарий - медиа(текст)

- **Traffic (write)** — `345 * 1 KB = 345 KB`
- **Traffic (read)** — `5778 * 1 KB = 5,778 KB`

### Комментарий - метаинформация(все кроме текста)

- **Traffic (write)** — `345 * 28 B = 9 KB`
- **Traffic (read)** — `5778 * 28 B = 157 KB`

---

### Реакция

- **RPS (write)** — `DAU * 5 / 86400 = 575`
- **Traffic (write)** — `575 * 1.3 KB = 0.75 MB`

---

### Общая

- **RPS (write)** — `38 (пост) + 345 (комментарий) + 575 (реакция) = 958`
- **RPS (read)** — `11574 (пост) + 5778 (комментарий) = 17,352`
- **Traffic (write)** — `17.5 MB (пост) + 0.345 MB (комментарий) + 0.75 MB (реакция) = 18.6 MB`
- **Traffic (read)** — `5,200.38 MB (пост) + 5.78 MB (комментарий) = 5,206 MB`
