# Social Network System Design

## Требования от бизнеса

- Публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия.
- Оценка и комментарии постов других путешественников.
- Подписка на других путешественников, чтобы следить за их активностью.
- Поиск популярных мест для путешествий и просмотр постов с этих мест.
- Просмотр ленты других путешественников и ленты пользователя, основанной на подписках в обратном хронологическом порядке.

### Будущая аудитория

- Предполагается, что через год система достигнет **10,000,000 уникальных пользователей в день** и будет продолжать расти.
- Ориентируемся на аудиторию **стран СНГ**.
- Платформа должна быть максимально **надежной**, удобной для мобильных устройств и браузеров.

## Домашняя работа. Урок 1

### Формализация функциональных требований

- **Пользователь** имеет аккаунт с личной информацией (фотографии + текстовые данные).
- Пользователь может публиковать **посты** (фотография + небольшое описание).
- **Места путешествий** подготовлены заранее.
- Пользователь может **подписываться** на других участников.
- Пользователь видит **список подписок**.
- Пользователь может **просматривать посты** других участников (ленту).
- Пользователь может **оценивать** и **комментировать** посты других пользователей.
- Система должна предоставлять **поиск по местам** и просмотр постов.
- Система должна **уведомлять пользователя** о новых комментариях и постах.
- Система должна поддерживать **хронологический порядок** постов.

### Нефункциональные требования

- **DAU (ежедневно активных пользователей)** — 10,000,000, с линейным ростом.
- Ориентируемся на **аудиторию СНГ**.
- Данные должны **храниться вечно**.
- **Мониторинг с системой оповещений** и система логирования.
- **Горизонтальная масштабируемость**.
- **Latency:** 100 - 300 ms.
- **SLA:** 99.9% (система должна переживать отказы узлов).
- **Безопасность**.

### Активности пользователей

- **Write operations**:
  - Реакция на пост: **5 в день**.
  - Комментарий на пост: **3 в день**.
  - Публикация постов: **1 в день**.

- **Read operations**:
  - Просмотр ленты: **100 раз в день** (по 10 объектов за раз).
  - Просмотр комментариев: **50 в день**

### Лимиты

- **Сообщение к посту**: длина до **1000 символов**.
- **Комментарий к посту**: длина до **280 символов**.
- **Фото в ленте**: вес **150 KB**.

### Сезонность

- Летом нагрузка может возрасти в **2-3 раза**.

### Транзакции

#### Транзакция — пост
- `id`: 16 байт
- `created_at`: 4 байта
- `photos`: 153,600 байт (для одного фото, в среднем 3 фото на пост)
- `text`: 1000 байт
- `user_id`: 4 байта
- `place_id`: 4 байта

#### Транзакция — комментарий
- `id`: 16 байт
- `created_at`: 4 байта
- `text`: 1000 байт
- `post_id`: 8 байт

#### Транзакция — реакция
- `id`: 16 байт
- `created_at`: 4 байта
- `post_id`: 8 байт
- `reaction_id`: 4 байта

---

## Нагрузка

### Обычная нагрузка — пост

- **RPS (write)** — `DAU * 1 / 86400 = 115`
- **RPS (read)** — `DAU * 100 / 86400 = 11574`
- **Traffic (write)** — `115 * 452 KB = 50.96 MB`
- **Traffic (read)** — `11574 * 452 KB = 5109.38 MB`

---

### В сезон — пост

- **RPS (write)** — `3 * DAU * 1 / 86400 = 345`
- **RPS (read)** — `3 * DAU * 100 / 86400 = 34722`
- **Traffic (write)** — `345 * 452 KB = 156.39 MB`
- **Traffic (read)** — `34,722 * 452 KB = 15,724.23 MB`

---

### Обычная нагрузка — комментарий

- **RPS (write)** — `DAU * 3 / 86400 = 345`
- **RPS (read)** — `DAU * 50 / 86400 = 5778`
- **Traffic (write)** — `345 * 1.3 KB = 0.45 MB`
- **Traffic (read)** — `5778 * 1.3 KB = 7.52 MB`

---

### В сезон (летом) — комментарий

- **RPS (write)** — `3 * DAU * 8 / 86400 = 2775`
- **RPS (read)** — `3 * DAU * 50 / 86400 = 17,361`
- **Traffic (write)** — `2775 * 1.3 KB = 3.61 MB`
- **Traffic (read)** — `17,361 * 1.3 KB = 22.58 MB`

---

### Обычная нагрузка — реакция

- **RPS (write)** — `DAU * 5 / 86400 = 575`
- **Traffic (write)** — `575 * 1.3 KB = 0.75 MB`

---

### В сезон (летом) — реакция

- **RPS (write)** — `3 * DAU * 5 / 86400 = 1725`
- **Traffic (write)** — `1725 * 1.3 KB = 2.24 MB`

---

### Обычная нагрузка — общая

- **RPS (write)** — `115 (пост) + 345 (комментарий) + 575 (реакция) = 1035`
- **RPS (read)** — `11574 (пост) + 5778 (комментарий) = 17352`
- **Traffic (write)** — `50.96 MB (пост) + 0.45 MB (комментарий) + 0.75 MB (реакция) = 52.16 MB`
- **Traffic (read)** — `5109.38 MB (пост) + 7.52 MB (комментарий) = 5,116.90 MB`

---

### В сезон (летом) — общая

- **RPS (write)** — `345 (пост) + 2775 (комментарий) + 1725 (реакция)** = 5845`
- **RPS (read)**  — `34722 (пост) + 17,361 (комментарий) = 51,083`
- **Traffic (write)** — `156.39 MB (пост) + 3.61 MB (комментарий) + 2.24 MB (реакция) = 162.24 MB`
- **Traffic (read)** — `15,724.23 MB (пост) + 22.58 MB (комментарий) = 15,746.81 MB`
